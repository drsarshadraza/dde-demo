<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phytomedix | Clinical Twin Engine</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #1b5e20;
      --secondary: #4caf50;
      --bg: #f4f7f6;
      --surface: #ffffff;
      --text: #2c3e50;
      --accent: #e8f5e9;
    }

    body {
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 600px;
      margin: 40px 20px;
    }

    /* HEADER */
    .header { text-align: center; margin-bottom: 20px; }
    .logo { color: var(--primary); font-size: 24px; font-weight: 900; letter-spacing: -0.5px; margin: 0; }
    .badge { 
      background: var(--accent); color: var(--primary); 
      font-size: 10px; font-weight: 700; 
      padding: 4px 8px; border-radius: 4px; 
      text-transform: uppercase; letter-spacing: 1px;
    }

    /* CARD UI */
    .card {
      background: var(--surface);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
    }

    /* WIZARD STEPS */
    .step { display: none; animation: slideIn 0.4s ease-out; }
    .step.active { display: block; }
    
    @keyframes slideIn { 
      from { opacity: 0; transform: translateX(20px); } 
      to { opacity: 1; transform: translateX(0); } 
    }

    /* PROGRESS BAR */
    .progress-container {
      height: 4px; background: #eee; border-radius: 2px; margin-bottom: 25px;
    }
    .progress-bar {
      height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; border-radius: 2px;
    }

    /* QUESTIONS */
    .q-label {
      display: block; font-size: 18px; font-weight: 700; margin-bottom: 10px; color: var(--text);
    }
    .q-sub {
      display: block; font-size: 13px; color: #666; margin-bottom: 20px;
    }

    /* INPUTS */
    input[type="text"], input[type="email"], input[type="number"] {
      width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px;
      font-size: 16px; box-sizing: border-box; transition: 0.2s;
    }
    input:focus { border-color: var(--secondary); outline: none; }

    /* SELECTION CARDS */
    .options-grid { display: grid; gap: 10px; }
    .option-card {
      display: flex; align-items: center; padding: 12px;
      border: 2px solid #eee; border-radius: 8px; cursor: pointer; transition: 0.2s;
    }
    .option-card:hover { border-color: #ccc; background: #fafafa; }
    .option-card:has(input:checked) {
      border-color: var(--primary); background-color: var(--accent); color: var(--primary); font-weight: 600;
    }
    input[type="radio"], input[type="checkbox"] { margin-right: 10px; accent-color: var(--primary); }

    /* BUTTONS */
    .btn-group { display: flex; justify-content: space-between; margin-top: 30px; }
    .btn {
      padding: 12px 24px; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; font-size: 14px;
    }
    .btn-next { background: var(--primary); color: white; flex: 1; margin-left: 10px; }
    .btn-back { background: #f0f0f0; color: #666; }
    .btn:disabled { background: #e0e0e0; cursor: not-allowed; }

    /* RESULTS VIEW */
    .result-view { display: none; text-align: center; }
    .score-card { margin-top: 20px; margin-bottom: 30px; }
    
    .loading-overlay {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(255,255,255,0.9); display: none;
      justify-content: center; align-items: center; z-index: 10;
      flex-direction: column;
    }
    .spinner { font-size: 40px; animation: spin 1s infinite linear; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1 class="logo">PHYTOMEDIX</h1>
    <span class="badge">Engine v15.0</span>
  </div>

  <div class="card">
    
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <form id="clinical-form">
      
      <div class="step active" data-step="1">
        <label class="q-label">Let's build your Digital Twin.</label>
        <span class="q-sub">We need a few basics to calibrate the engine.</span>
        
        <div style="margin-bottom: 15px;">
          <input type="text" name="name" placeholder="First Name" required>
        </div>
        <div style="margin-bottom: 15px;">
          <input type="email" name="email" placeholder="Email Address" required>
        </div>
        <div style="display:flex; gap:10px;">
          <input type="number" name="Q-001" placeholder="Age" style="flex:1" required>
          <div style="flex:1; border:2px solid #eee; border-radius:8px; display:flex; align-items:center; padding-left:10px;">
            <select name="Q-002" style="border:none; width:100%; outline:none; background:transparent;">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
        </div>
      </div>

      <div class="step" data-step="2">
        <label class="q-label">Biometric Scan</label>
        <span class="q-sub">These numbers help us calculate metabolic load.</span>
        
        <div style="display:flex; gap:10px; margin-bottom:15px;">
          <input type="number" name="Q-021" placeholder="Weight (kg)">
          <input type="number" name="Q-022" placeholder="Height (cm)">
        </div>
        <input type="number" name="Q-020" placeholder="Fasting Glucose (mg/dL) - Optional">
      </div>

      <div class="step" data-step="3">
        <label class="q-label">System Diagnostics</label>
        <span class="q-sub">Select everything that applies to you.</span>
        
        <div class="options-grid">
          <label class="option-card"><input type="checkbox" name="Q-010" value="Diabetes Type 2"> Diabetes / High Blood Sugar</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="High Cholesterol"> High Cholesterol</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="Hypertension"> High Blood Pressure</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="Brain Fog / Focus Issues"> Brain Fog / Low Focus</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="Joint Pain / Arthritis"> Joint Pain / Stiffness</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="Low Energy / Fatigue"> Chronic Fatigue</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="IBS (Irritable Bowel)"> Gut Issues (IBS/Bloating)</label>
          <label class="option-card"><input type="checkbox" name="Q-010" value="Low Libido (Men)"> Low Libido / Vitality</label>
        </div>
      </div>

      <div class="step" data-step="4">
        <label class="q-label">Targeted Assessment</label>
        
        <p style="margin-bottom:5px; font-weight:600;">Daily Focus & Memory?</p>
        <div class="options-grid" style="margin-bottom:20px;">
          <label class="option-card"><input type="radio" name="Q-023" value="Low"> Low (Struggling)</label>
          <label class="option-card"><input type="radio" name="Q-023" value="Average"> Average</label>
          <label class="option-card"><input type="radio" name="Q-023" value="High"> High (Sharp)</label>
        </div>

        <p style="margin-bottom:5px; font-weight:600;">Joint Stiffness?</p>
        <div class="options-grid">
          <label class="option-card"><input type="radio" name="Q-024" value="Yes"> Yes, regularly</label>
          <label class="option-card"><input type="radio" name="Q-024" value="No"> No, rarely</label>
        </div>
      </div>

      <div class="step" data-step="5">
        <label class="q-label">Safety Check</label>
        <span class="q-sub">We cross-reference contraindications.</span>
        
        <p>Do you smoke?</p>
        <div class="options-grid" style="margin-bottom:15px;">
          <label class="option-card"><input type="radio" name="Q-003" value="Never"> Never</label>
          <label class="option-card"><input type="radio" name="Q-003" value="Current"> Currently</label>
        </div>

        <p>Shortness of breath on exertion?</p>
        <div class="options-grid">
          <label class="option-card"><input type="radio" name="Q-015" value="No"> No</label>
          <label class="option-card"><input type="radio" name="Q-015" value="Yes"> Yes (Safety Flag)</label>
        </div>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-back" id="prevBtn" onclick="nextPrev(-1)" disabled>Back</button>
        <button type="button" class="btn btn-next" id="nextBtn" onclick="nextPrev(1)">Next Step</button>
      </div>

    </form>

    <div class="loading-overlay" id="loader">
      <div class="spinner">ðŸ§¬</div>
      <p>Generating Clinical Twin...</p>
      <p style="font-size:12px; color:#666;">Analyzing Contraindications...</p>
    </div>

    <div id="result-view" class="result-view">
      <h2 style="color:var(--primary);">Analysis Complete</h2>
      <p style="color:#666;">Here is your Digital Health Twin.</p>
      
      <div class="score-card">
        <canvas id="twinChart"></canvas>
      </div>

      <div style="background:#e8f5e9; padding:15px; border-radius:8px; margin-bottom:20px;">
        <strong>âœ… Protocol Generated</strong><br>
        <span style="font-size:13px;">Your custom formulation has been sent to the lab queue.</span>
      </div>

      <button onclick="location.reload()" class="btn btn-next" style="width:100%;">Start New Session</button>
    </div>

  </div>
</div>

<script>
  // --- CONFIGURATION ---
  const ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbyhP5V0najpzFsTivvfo6fIwZh5W4Hmdq18JCCYXguzxs8PHm28kq1pjj84p5jj2TzsWg/exec';
  let currentStep = 0;
  const steps = document.querySelectorAll(".step");

  showStep(currentStep);

  function showStep(n) {
    steps.forEach((s, index) => {
      s.classList.remove("active");
      if(index === n) s.classList.add("active");
    });

    // Button Logic
    document.getElementById("prevBtn").disabled = (n === 0);
    document.getElementById("nextBtn").innerHTML = (n === steps.length - 1) ? "Run Analysis" : "Next Step";
    
    // Progress Bar
    const progress = ((n + 1) / steps.length) * 100;
    document.getElementById("progressBar").style.width = progress + "%";
  }

  function nextPrev(n) {
    // Validation could go here
    currentStep += n;
    
    if (currentStep >= steps.length) {
      submitForm();
      return;
    }
    showStep(currentStep);
  }

  async function submitForm() {
    document.getElementById("loader").style.display = "flex";
    
    const formData = new FormData(document.getElementById("clinical-form"));
    const data = Object.fromEntries(formData.entries());
    
    // Handle Multi-Select (Q-010)
    const checked = Array.from(document.querySelectorAll('input[name="Q-010"]:checked')).map(cb => cb.value);
    data['Q-010'] = checked.join('; ');

    try {
      const response = await fetch(ENDPOINT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(data)
      });

      // MOCK RESPONSE FOR VISUALIZATION (Since no-cors blocks reading actual response in client)
      // In production, you would read the JSON response. Here we simulate the chart based on inputs.
      setTimeout(() => {
        document.getElementById("loader").style.display = "none";
        document.getElementById("clinical-form").style.display = "none";
        document.querySelector(".btn-group").style.display = "none";
        document.getElementById("result-view").style.display = "block";
        
        renderChart(data);
      }, 2000);

    } catch (err) {
      alert("Error connecting to engine.");
      document.getElementById("loader").style.display = "none";
    }
  }

  function renderChart(data) {
    // Simple logic to simulate scores for the chart based on inputs
    // This makes the demo feel "Real" immediately
    let scores = {
      metabolic: data['Q-010'].includes('Diabetes') ? 90 : 30,
      cardio: data['Q-010'].includes('Hypertension') ? 80 : 20,
      cognitive: data['Q-023'] === 'Low' ? 75 : 25,
      joints: data['Q-024'] === 'Yes' ? 85 : 15,
      gut: data['Q-010'].includes('IBS') ? 70 : 10,
      hormonal: 40 // Baseline
    };

    const ctx = document.getElementById('twinChart').getContext('2d');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['Metabolic', 'Cardio', 'Cognitive', 'Joints', 'Gut', 'Hormonal'],
        datasets: [{
          label: 'Systemic Risk Load',
          data: [scores.metabolic, scores.cardio, scores.cognitive, scores.joints, scores.gut, scores.hormonal],
          backgroundColor: 'rgba(27, 94, 32, 0.2)',
          borderColor: '#1b5e20',
          pointBackgroundColor: '#1b5e20',
          borderWidth: 2
        }]
      },
      options: {
        scales: {
          r: {
            angleLines: { color: '#eee' },
            grid: { color: '#eee' },
            suggestedMin: 0,
            suggestedMax: 100
          }
        }
      }
    });
  }
</script>

</body>
</html>
